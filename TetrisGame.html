<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tetris Game - Cosmic Edition</title>
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --text-glow: rgba(138, 43, 226, 0.5);
            
            /* Responsive sizing based on viewport */
            --container-width: min(95vw, 1400px);
            --board-width: min(60vh, 60vw, 400px);
            --cell-size: calc(var(--board-width) / 12);
            --base-font: clamp(14px, 1.5vw, 18px);
            
            /* Tetris piece colors */
            --t-cyan: #00d4ff;
            --t-blue: #0088ff;
            --t-orange: #ff8800;
            --t-yellow: #ffff00;
            --t-green: #00ff00;
            --t-purple: #8800ff;
            --t-red: #ff0000;
            --t-gray: #888888;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        button:focus, .cell:focus, .mode-btn:focus, .diff-btn:focus {
            outline: none;
            box-shadow: 0 0 15px rgba(138, 43, 226, 0.7), 0 0 25px currentColor;
            transition: box-shadow 0.3s ease;
        }

        body.light-theme button:focus, body.light-theme .cell:focus {
            box-shadow: 0 0 10px rgba(138, 43, 226, 0.3), 0 0 15px currentColor;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', 'PingFang SC', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a0a0a;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
            color: #ffffff;
            transition: background 0.5s ease, color 0.5s ease;
            font-size: var(--base-font);
        }

        body.light-theme {
            background: #f0f0f0;
            color: #333333;
        }

        body::before {
            content: '';
            position: fixed;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 20% 50%, #1a1a2e 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, #16213e 0%, transparent 50%),
                        radial-gradient(circle at 40% 20%, #0f3460 0%, transparent 50%);
            animation: gradientShift 20s ease infinite;
            opacity: 1;
            transition: opacity 0.5s ease;
            z-index: -1;
        }

        body.light-theme::before {
            background: radial-gradient(circle at 20% 50%, #e0e7ff 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, #d6e4ff 0%, transparent 50%),
                        radial-gradient(circle at 40% 20%, #c7d2fe 0%, transparent 50%);
            opacity: 0.5;
        }

        @keyframes gradientShift {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(-20px, -20px) rotate(120deg); }
            66% { transform: translate(20px, -10px) rotate(240deg); }
        }

        .main-container {
            width: var(--container-width);
            max-width: 100%;
            display: flex;
            gap: 40px;
            align-items: flex-start;
            position: relative;
            z-index: 1;
        }

        .game-container {
            flex: 1;
            background: rgba(20, 20, 30, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.5),
                        0 0 100px rgba(138, 43, 226, 0.1),
                        inset 0 0 30px rgba(138, 43, 226, 0.05);
            transition: all 0.5s ease;
            position: relative;
            overflow: visible;
        }

        body.light-theme .game-container {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.1),
                        0 0 100px rgba(138, 43, 226, 0.05),
                        inset 0 0 30px rgba(138, 43, 226, 0.02);
        }

        .side-panel {
            width: 350px;
            background: rgba(20, 20, 30, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 30px;
            padding: 30px;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.5);
            transition: all 0.5s ease;
            overflow: hidden;
        }

        body.light-theme .side-panel {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.1);
        }

        /* Language Selector */
        .language-selector {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 10;
            display: flex;
            gap: 10px;
        }

        .lang-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        body.light-theme .lang-btn {
            background: rgba(0, 0, 0, 0.05);
            border: 2px solid rgba(0, 0, 0, 0.1);
            color: #333;
        }

        .lang-btn.active {
            background: var(--primary-gradient);
            border-color: transparent;
            transform: scale(1.1);
            box-shadow: 0 5px 20px rgba(138, 43, 226, 0.4);
        }

        .lang-btn:hover:not(.active) {
            background: rgba(138, 43, 226, 0.3);
            transform: scale(1.05);
        }

        h1 {
            text-align: center;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 30px;
            margin-top: 20px;
            font-size: 3.5em;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 3px;
            filter: drop-shadow(0 0 30px var(--text-glow));
            animation: glow 2s ease-in-out infinite alternate;
        }

        body.light-theme h1 {
            --text-glow: rgba(138, 43, 226, 0.2);
            filter: drop-shadow(0 0 10px rgba(0, 0, 0, 0.1));
        }

        @keyframes glow {
            from { filter: drop-shadow(0 0 20px var(--text-glow)); }
            to { filter: drop-shadow(0 0 30px var(--text-glow)) drop-shadow(0 0 40px var(--text-glow)); }
        }

        .game-area {
            display: flex;
            gap: 30px;
            justify-content: center;
            align-items: flex-start;
            margin: 30px 0;
        }

        .game-board {
            width: var(--board-width);
            height: calc(var(--board-width) * 2);
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 20px;
            box-shadow: inset 0 0 40px rgba(0, 0, 0, 0.5);
            position: relative;
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(20, 1fr);
            gap: 2px;
        }

        body.light-theme .game-board {
            background: rgba(255, 255, 255, 0.3);
            box-shadow: inset 0 0 40px rgba(0, 0, 0, 0.1);
        }

        .cell {
            background: linear-gradient(145deg, #1a1a2e, #0f0f1e);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            transition: all 0.2s ease;
            position: relative;
        }

        body.light-theme .cell {
            background: linear-gradient(145deg, #e9ecef, #dee2e6);
            border: 1px solid rgba(0, 0, 0, 0.15);
        }

        body.light-theme .cell.filled {
            border-color: currentColor;
            border-width: 2px;
            box-shadow: 0 0 14px currentColor, 0 0 0 2px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.6);
        }

        /* Light theme: fill blocks with their colors for better visibility */
        body.light-theme .cell.I { 
            background: linear-gradient(145deg, #00f5ff, #00bcd4) !important; 
        }
        body.light-theme .cell.O { 
            background: linear-gradient(145deg, #ffeb3b, #ffc107) !important; 
        }
        body.light-theme .cell.T { 
            background: linear-gradient(145deg, #9c27b0, #673ab7) !important; 
        }
        body.light-theme .cell.S { 
            background: linear-gradient(145deg, #4caf50, #388e3c) !important; 
        }
        body.light-theme .cell.Z { 
            background: linear-gradient(145deg, #f44336, #d32f2f) !important; 
        }
        body.light-theme .cell.J { 
            background: linear-gradient(145deg, #2196f3, #1976d2) !important; 
        }
        body.light-theme .cell.L { 
            background: linear-gradient(145deg, #ff9800, #f57c00) !important; 
        }

        .cell.filled {
            border-color: currentColor;
            border-width: 2px;
            box-shadow: 0 0 12px currentColor, 0 0 0 2px rgba(0, 0, 0, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.5);
        }

        .cell.ghost {
            background: transparent;
            border: 2px dashed rgba(255, 255, 255, 0.8);
            box-shadow: 0 0 6px rgba(255, 255, 255, 0.4);
            opacity: 0.5;
        }

        body.light-theme .cell.ghost {
            border-color: rgba(0, 0, 0, 0.7);
            box-shadow: 0 0 6px rgba(0, 0, 0, 0.3);
        }

        /* Tetris piece colors */
        .cell.I { 
            background: linear-gradient(145deg, #00f5ff, #00bcd4); 
            border: 2px solid #006064;
            box-shadow: 0 0 8px rgba(0, 245, 255, 0.6), inset 0 1px 0 rgba(255, 255, 255, 0.3);
            color: var(--t-cyan); 
        }
        .cell.O { 
            background: linear-gradient(145deg, #ffeb3b, #ffc107); 
            border: 2px solid #ff8f00;
            box-shadow: 0 0 8px rgba(255, 235, 59, 0.6), inset 0 1px 0 rgba(255, 255, 255, 0.3);
            color: var(--t-yellow); 
        }
        .cell.T { 
            background: linear-gradient(145deg, #9c27b0, #673ab7); 
            border: 2px solid #4a148c;
            box-shadow: 0 0 8px rgba(156, 39, 176, 0.6), inset 0 1px 0 rgba(255, 255, 255, 0.3);
            color: var(--t-purple); 
        }
        .cell.S { 
            background: linear-gradient(145deg, #4caf50, #388e3c); 
            border: 2px solid #1b5e20;
            box-shadow: 0 0 8px rgba(76, 175, 80, 0.6), inset 0 1px 0 rgba(255, 255, 255, 0.3);
            color: var(--t-green); 
        }
        .cell.Z { 
            background: linear-gradient(145deg, #f44336, #d32f2f); 
            border: 2px solid #b71c1c;
            box-shadow: 0 0 8px rgba(244, 67, 54, 0.6), inset 0 1px 0 rgba(255, 255, 255, 0.3);
            color: var(--t-red); 
        }
        .cell.J { 
            background: linear-gradient(145deg, #2196f3, #1976d2); 
            border: 2px solid #0d47a1;
            box-shadow: 0 0 8px rgba(33, 150, 243, 0.6), inset 0 1px 0 rgba(255, 255, 255, 0.3);
            color: var(--t-blue); 
        }
        .cell.L { 
            background: linear-gradient(145deg, #ff9800, #f57c00); 
            border: 2px solid #e65100;
            box-shadow: 0 0 8px rgba(255, 152, 0, 0.6), inset 0 1px 0 rgba(255, 255, 255, 0.3);
            color: var(--t-orange); 
        }

        .next-pieces {
            width: 150px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .next-piece {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        body.light-theme .next-piece {
            background: rgba(255, 255, 255, 0.3);
        }

        .next-piece h3 {
            font-size: 1em;
            margin-bottom: 10px;
            color: #8b92a9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        body.light-theme .next-piece h3 {
            color: #666666;
        }

        .mini-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 2px;
            width: 60px;
            height: 60px;
        }

        .mini-cell {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            transition: all 0.2s ease;
        }

        body.light-theme .mini-cell {
            background: rgba(0, 0, 0, 0.1);
        }

        /* Light theme: fill mini-cells with their colors for better visibility */
        body.light-theme .mini-cell.I { 
            background: linear-gradient(145deg, #00f5ff, #00bcd4) !important; 
        }
        body.light-theme .mini-cell.O { 
            background: linear-gradient(145deg, #ffeb3b, #ffc107) !important; 
        }
        body.light-theme .mini-cell.T { 
            background: linear-gradient(145deg, #9c27b0, #673ab7) !important; 
        }
        body.light-theme .mini-cell.S { 
            background: linear-gradient(145deg, #4caf50, #388e3c) !important; 
        }
        body.light-theme .mini-cell.Z { 
            background: linear-gradient(145deg, #f44336, #d32f2f) !important; 
        }
        body.light-theme .mini-cell.J { 
            background: linear-gradient(145deg, #2196f3, #1976d2) !important; 
        }
        body.light-theme .mini-cell.L { 
            background: linear-gradient(145deg, #ff9800, #f57c00) !important; 
        }

        .mini-cell.filled {
            box-shadow: 0 0 5px currentColor;
        }

        .score-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }

        .score-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }

        body.light-theme .score-item {
            background: rgba(0, 0, 0, 0.05);
        }

        .score-item h3 {
            font-size: 0.9em;
            margin-bottom: 8px;
            color: #8b92a9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        body.light-theme .score-item h3 {
            color: #666666;
        }

        .score-item p {
            font-size: 2em;
            font-weight: bold;
            color: #00d4ff;
            text-shadow: 0 0 15px currentColor;
        }

        .status {
            text-align: center;
            margin: 20px 0;
            font-size: 1.4em;
            color: #ffffff;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            transition: all 0.5s ease;
        }

        body.light-theme .status {
            color: #333333;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 30px;
        }

        button {
            padding: 16px 32px;
            font-size: 1.1em;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
            color: white;
        }

        body.light-theme button {
            color: #333333;
        }

        button:hover {
            transform: translateY(-3px);
        }

        .btn-primary {
            background: var(--primary-gradient);
            box-shadow: 0 5px 25px rgba(138, 43, 226, 0.4);
        }

        .btn-secondary {
            background: var(--secondary-gradient);
            box-shadow: 0 5px 25px rgba(240, 147, 251, 0.4);
        }

        .btn-theme {
            background: linear-gradient(135deg, #333333 0%, #555555 100%);
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.4);
        }

        body.light-theme .btn-theme {
            background: linear-gradient(135deg, #dddddd 0%, #eeeeee 100%);
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.1);
        }

        .difficulty-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .diff-btn {
            padding: 12px 20px;
            border: 2px solid rgba(138, 43, 226, 0.3);
            background: rgba(138, 43, 226, 0.1);
            color: #a0a0a0;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.9em;
        }

        body.light-theme .diff-btn {
            border: 2px solid rgba(138, 43, 226, 0.2);
            background: rgba(138, 43, 226, 0.05);
            color: #666666;
        }

        .diff-btn.active {
            background: var(--primary-gradient);
            color: white;
            border-color: transparent;
            box-shadow: 0 5px 20px rgba(138, 43, 226, 0.5);
            transform: scale(1.05);
        }

        .diff-btn:hover:not(.active) {
            background: rgba(138, 43, 226, 0.2);
            transform: scale(1.02);
        }

        .game-over-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
            border-radius: 30px;
        }

        body.light-theme .game-over-overlay {
            background: rgba(255, 255, 255, 0.9);
        }

        .game-over-content {
            background: rgba(20, 20, 30, 0.95);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            color: white;
            max-width: 400px;
        }

        body.light-theme .game-over-content {
            background: rgba(255, 255, 255, 0.95);
            color: #333333;
        }

        .game-over-content h2 {
            font-size: 2.5em;
            margin-bottom: 20px;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .game-over-content p {
            font-size: 1.2em;
            margin: 10px 0;
        }

        /* Particle effects */
        .particle {
            position: fixed;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            pointer-events: none;
            opacity: 0.3;
            animation: float 15s infinite linear;
            z-index: -1;
        }

        body.light-theme .particle {
            background: linear-gradient(135deg, #a5d8ff, #ffd3e0);
            opacity: 0.2;
        }

        @keyframes float {
            0% { transform: translateY(100vh) translateX(0); opacity: 0; }
            10% { opacity: 0.3; }
            90% { opacity: 0.3; }
            100% { transform: translateY(-100vh) translateX(50px); opacity: 0; }
        }

        .line-clear-effect {
            animation: lineClear 0.5s ease-out;
        }

        @keyframes lineClear {
            0% { background: #ffffff; transform: scaleX(1); }
            50% { background: #ffd700; transform: scaleX(1.1); }
            100% { background: transparent; transform: scaleX(0); }
        }

        /* Responsive */
        @media (max-width: 1400px) {
            .main-container {
                flex-direction: column;
                align-items: center;
            }

            .side-panel {
                width: 100%;
                max-width: 600px;
            }

            .game-container {
                max-width: 600px;
            }
        }

        @media (max-width: 768px) {
            :root {
                --board-width: min(80vw, 300px);
            }

            h1 {
                font-size: 2.5em;
            }

            .controls {
                grid-template-columns: 1fr;
            }

            .difficulty-selector {
                grid-template-columns: repeat(2, 1fr);
            }

            .game-area {
                flex-direction: column;
                align-items: center;
            }

            .next-pieces {
                width: 100%;
                flex-direction: row;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="game-container">
            <!-- Language Selector -->
            <div class="language-selector">
                <button class="lang-btn active" onclick="setLanguage('en', event)">🇬🇧 EN</button>
                <button class="lang-btn" onclick="setLanguage('zh', event)">🇨🇳 中文</button>
            </div>

            <h1 data-i18n="title">🎮 TETRIS COSMIC 🎮</h1>
            
            <div class="difficulty-selector">
                <button class="diff-btn" data-diff="easy" onclick="setDifficulty('easy', event)" data-i18n="diff.easy">Easy</button>
                <button class="diff-btn active" data-diff="medium" onclick="setDifficulty('medium', event)" data-i18n="diff.medium">Medium</button>
                <button class="diff-btn" data-diff="hard" onclick="setDifficulty('hard', event)" data-i18n="diff.hard">Hard</button>
            </div>

            <div class="status" id="status" data-i18n="status.ready">Ready to Play!</div>

            <div class="game-area">
                <div class="game-board" id="gameBoard"></div>
                
                <div class="next-pieces">
                    <div class="next-piece">
                        <h3 data-i18n="next">Next</h3>
                        <div class="mini-grid" id="nextPiece"></div>
                    </div>

                </div>
            </div>

            <div class="controls">
                <button class="btn-primary" onclick="startGame()" data-i18n="btn.start">Start Game</button>
                <button class="btn-secondary" onclick="pauseGame()" data-i18n="btn.pause">Pause</button>
                <button class="btn-primary" onclick="resetGame()" data-i18n="btn.reset">Reset</button>
                <button class="btn-theme" id="themeToggle" onclick="toggleTheme()">🌙 Dark</button>
            </div>

            <!-- Game Over Overlay -->
            <div class="game-over-overlay" id="gameOverOverlay">
                <div class="game-over-content">
                    <h2 data-i18n="gameOver.title">Game Over!</h2>
                    <p data-i18n="gameOver.score">Final Score:</p>
                    <p id="finalScore">0</p>
                    <p data-i18n="gameOver.lines">Lines Cleared:</p>
                    <p id="finalLines">0</p>
                    <button class="btn-primary" onclick="resetGame()" data-i18n="btn.playAgain">Play Again</button>
                </div>
            </div>
        </div>

        <div class="side-panel">
            <div class="score-section">
                <div class="score-item">
                    <h3 data-i18n="score.score">Score</h3>
                    <p id="scoreDisplay">0</p>
                </div>
                <div class="score-item">
                    <h3 data-i18n="score.lines">Lines</h3>
                    <p id="linesDisplay">0</p>
                </div>
                <div class="score-item">
                    <h3 data-i18n="score.level">Level</h3>
                    <p id="levelDisplay">1</p>
                </div>
                <div class="score-item">
                    <h3 data-i18n="score.speed">Speed</h3>
                    <p id="speedDisplay">1x</p>
                </div>
            </div>

            <div class="next-piece">
                <h3 data-i18n="controls.title">Controls</h3>
                <div style="text-align: left; font-size: 0.9em; line-height: 1.6;">
                    <p data-i18n="controls.arrows">← → ↓ Move</p>
                    <p data-i18n="controls.rotate">↑ Rotate</p>
                    <p data-i18n="controls.space">Space Hard Drop</p>

                    <p data-i18n="controls.pause">P Pause</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Translations
        const translations = {
            en: {
                title: "🎮 TETRIS COSMIC 🎮",
                diff: {
                    easy: "Easy",
                    medium: "Medium",
                    hard: "Hard"
                },
                score: {
                    score: "Score",
                    lines: "Lines",
                    level: "Level",
                    speed: "Speed"
                },
                status: {
                    ready: "Ready to Play!",
                    playing: "Playing...",
                    paused: "Paused",
                    gameOver: "Game Over!"
                },
                btn: {
                    start: "Start Game",
                    pause: "Pause",
                    reset: "Reset",
                    playAgain: "Play Again"
                },
                gameOver: {
                    title: "Game Over!",
                    score: "Final Score:",
                    lines: "Lines Cleared:"
                },
                next: "Next",
    
                controls: {
                    title: "Controls",
                    arrows: "← → ↓ Move",
                    rotate: "↑ Rotate",
                    space: "Space Hard Drop",
        
                    pause: "P Pause"
                },
                theme: {
                    dark: "🌙 Dark",
                    light: "☀️ Light"
                }
            },
            zh: {
                title: "🎮 宇宙俄罗斯方块 🎮",
                diff: {
                    easy: "简单",
                    medium: "中等",
                    hard: "困难"
                },
                score: {
                    score: "分数",
                    lines: "行数",
                    level: "等级",
                    speed: "速度"
                },
                status: {
                    ready: "准备开始！",
                    playing: "游戏中...",
                    paused: "已暂停",
                    gameOver: "游戏结束！"
                },
                btn: {
                    start: "开始游戏",
                    pause: "暂停",
                    reset: "重置",
                    playAgain: "再玩一次"
                },
                gameOver: {
                    title: "游戏结束！",
                    score: "最终分数：",
                    lines: "消除行数："
                },
                next: "下一个",
    
                controls: {
                    title: "控制",
                    arrows: "← → ↓ 移动",
                    rotate: "↑ 旋转",
                    space: "空格 快速下落",
        
                    pause: "P 暂停"
                },
                theme: {
                    dark: "🌙 深色",
                    light: "☀️ 浅色"
                }
            }
        };

        // Game variables
        let board = Array(20).fill().map(() => Array(10).fill(0));
        let currentPiece = null;
        let currentPosition = { x: 4, y: 0 };
        let nextPiece = null;

        let gameRunning = false;
        let gamePaused = false;
        let gameInterval = null;
        let currentLanguage = 'en';
        let difficulty = 'medium';
        let score = 0;
        let lines = 0;
        let level = 1;
        let fallSpeed = 1000;

        // Tetris pieces
        const pieces = {
            I: {
                shape: [
                    [0, 0, 0, 0],
                    [1, 1, 1, 1],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0]
                ],
                color: 'I'
            },
            O: {
                shape: [
                    [1, 1],
                    [1, 1]
                ],
                color: 'O'
            },
            T: {
                shape: [
                    [0, 1, 0],
                    [1, 1, 1],
                    [0, 0, 0]
                ],
                color: 'T'
            },
            S: {
                shape: [
                    [0, 1, 1],
                    [1, 1, 0],
                    [0, 0, 0]
                ],
                color: 'S'
            },
            Z: {
                shape: [
                    [1, 1, 0],
                    [0, 1, 1],
                    [0, 0, 0]
                ],
                color: 'Z'
            },
            J: {
                shape: [
                    [1, 0, 0],
                    [1, 1, 1],
                    [0, 0, 0]
                ],
                color: 'J'
            },
            L: {
                shape: [
                    [0, 0, 1],
                    [1, 1, 1],
                    [0, 0, 0]
                ],
                color: 'L'
            }
        };

        const pieceTypes = ['I', 'O', 'T', 'S', 'Z', 'J', 'L'];
        
        // DOM elements
        const statusDisplay = document.getElementById('status');
        const gameBoard = document.getElementById('gameBoard');
        const nextPieceDisplay = document.getElementById('nextPiece');

        const scoreDisplay = document.getElementById('scoreDisplay');
        const linesDisplay = document.getElementById('linesDisplay');
        const levelDisplay = document.getElementById('levelDisplay');
        const speedDisplay = document.getElementById('speedDisplay');
        const gameOverOverlay = document.getElementById('gameOverOverlay');
        const finalScore = document.getElementById('finalScore');
        const finalLines = document.getElementById('finalLines');
        const themeToggle = document.getElementById('themeToggle');

        // Initialize game board
        function initBoard() {
            gameBoard.innerHTML = '';
            for (let row = 0; row < 20; row++) {
                for (let col = 0; col < 10; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    gameBoard.appendChild(cell);
                }
            }
        }

        // Generate random piece
        function randomPiece() {
            const type = pieceTypes[Math.floor(Math.random() * pieceTypes.length)];
            return JSON.parse(JSON.stringify(pieces[type]));
        }

        // Rotate piece
        function rotatePiece(piece) {
            const rotated = JSON.parse(JSON.stringify(piece));
            const n = rotated.shape.length;
            
            for (let i = 0; i < n; i++) {
                for (let j = 0; j < n; j++) {
                    rotated.shape[i][j] = piece.shape[n - 1 - j][i];
                }
            }
            
            return rotated;
        }

        // Check if position is valid
        function isValidPosition(piece, position) {
            for (let row = 0; row < piece.shape.length; row++) {
                for (let col = 0; col < piece.shape[row].length; col++) {
                    if (piece.shape[row][col]) {
                        const newRow = position.y + row;
                        const newCol = position.x + col;
                        
                        if (newRow >= 20 || newCol < 0 || newCol >= 10 || 
                            (newRow >= 0 && board[newRow][newCol])) {
                            return false;
                        }
                    }
                }
            }
            return true;
        }

        // Place piece on board
        function placePiece(piece, position) {
            for (let row = 0; row < piece.shape.length; row++) {
                for (let col = 0; col < piece.shape[row].length; col++) {
                    if (piece.shape[row][col]) {
                        const boardRow = position.y + row;
                        const boardCol = position.x + col;
                        if (boardRow >= 0) {
                            board[boardRow][boardCol] = piece.color;
                        }
                    }
                }
            }
        }

        // Clear completed lines
        function clearLines() {
            let linesCleared = 0;
            
            for (let row = 19; row >= 0; row--) {
                if (board[row].every(cell => cell !== 0)) {
                    // Animate line clear
                    for (let col = 0; col < 10; col++) {
                        const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                        if (cell) {
                            cell.classList.add('line-clear-effect');
                        }
                    }
                    
                    setTimeout(() => {
                        board.splice(row, 1);
                        board.unshift(Array(10).fill(0));
                        linesCleared++;
                        row++; // Check same row again
                    }, 250);
                }
            }
            
            if (linesCleared > 0) {
                lines += linesCleared;
                score += linesCleared * 100 * level * (linesCleared > 1 ? linesCleared : 1);
                level = Math.floor(lines / 10) + 1;
                
                // Adjust speed based on difficulty and level
                const baseSpeed = difficulty === 'easy' ? 1200 : difficulty === 'medium' ? 1000 : 800;
                fallSpeed = Math.max(50, baseSpeed - (level - 1) * 50);
                
                updateDisplay();
                
                if (gameInterval) {
                    clearInterval(gameInterval);
                    gameInterval = setInterval(gameLoop, fallSpeed);
                }
            }
        }

        // Update display
        function updateDisplay() {
            scoreDisplay.textContent = score.toLocaleString();
            linesDisplay.textContent = lines;
            levelDisplay.textContent = level;
            speedDisplay.textContent = `${(1000 / fallSpeed).toFixed(1)}x`;
        }

        // Render game
        function render() {
            // Clear board display
            document.querySelectorAll('.cell').forEach(cell => {
                cell.className = 'cell';
            });
            
            // Render placed pieces
            for (let row = 0; row < 20; row++) {
                for (let col = 0; col < 10; col++) {
                    if (board[row][col]) {
                        const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                        if (cell) {
                            cell.classList.add('filled', board[row][col]);
                        }
                    }
                }
            }
            
            // Render current piece
            if (currentPiece) {
                renderPieceOnBoard(currentPiece, currentPosition);
                
                // Render ghost piece
                const ghostPosition = getGhostPosition();
                if (ghostPosition.y !== currentPosition.y) {
                    renderGhostPiece(currentPiece, ghostPosition);
                }
            }
            
            // Render next piece
            renderMiniPiece(nextPiece, nextPieceDisplay);
            

        }

        // Render piece on main board
        function renderPieceOnBoard(piece, position) {
            for (let row = 0; row < piece.shape.length; row++) {
                for (let col = 0; col < piece.shape[row].length; col++) {
                    if (piece.shape[row][col]) {
                        const boardRow = position.y + row;
                        const boardCol = position.x + col;
                        
                        if (boardRow >= 0 && boardRow < 20 && boardCol >= 0 && boardCol < 10) {
                            const cell = document.querySelector(`[data-row="${boardRow}"][data-col="${boardCol}"]`);
                            if (cell && !cell.classList.contains('filled')) {
                                cell.classList.add('filled', piece.color);
                            }
                        }
                    }
                }
            }
        }

        // Get ghost piece position
        function getGhostPosition() {
            let ghostPosition = { ...currentPosition };
            
            while (isValidPosition(currentPiece, { x: ghostPosition.x, y: ghostPosition.y + 1 })) {
                ghostPosition.y++;
            }
            
            return ghostPosition;
        }

        // Render ghost piece
        function renderGhostPiece(piece, position) {
            for (let row = 0; row < piece.shape.length; row++) {
                for (let col = 0; col < piece.shape[row].length; col++) {
                    if (piece.shape[row][col]) {
                        const boardRow = position.y + row;
                        const boardCol = position.x + col;
                        
                        if (boardRow >= 0 && boardRow < 20 && boardCol >= 0 && boardCol < 10) {
                            const cell = document.querySelector(`[data-row="${boardRow}"][data-col="${boardCol}"]`);
                            if (cell && !cell.classList.contains('filled')) {
                                cell.classList.add('ghost');
                            }
                        }
                    }
                }
            }
        }

        // Render mini piece
        function renderMiniPiece(piece, container) {
            container.innerHTML = '';
            
            if (!piece) {
                for (let i = 0; i < 16; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'mini-cell';
                    container.appendChild(cell);
                }
                return;
            }
            
            for (let row = 0; row < 4; row++) {
                for (let col = 0; col < 4; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'mini-cell';
                    
                    if (row < piece.shape.length && col < piece.shape[row].length && piece.shape[row][col]) {
                        cell.classList.add('filled', piece.color);
                    }
                    
                    container.appendChild(cell);
                }
            }
        }

        // Move piece
        function movePiece(dx, dy) {
            if (!currentPiece || gamePaused) return false;
            
            const newPosition = { x: currentPosition.x + dx, y: currentPosition.y + dy };
            
            if (isValidPosition(currentPiece, newPosition)) {
                currentPosition = newPosition;
                render();
                return true;
            }
            
            return false;
        }

        // Rotate current piece
        function rotateCurrent() {
            if (!currentPiece || gamePaused) return;
            
            const rotated = rotatePiece(currentPiece);
            
            if (isValidPosition(rotated, currentPosition)) {
                currentPiece = rotated;
                render();
            }
        }

        // Hard drop
        function hardDrop() {
            if (!currentPiece || gamePaused) return;
            
            while (movePiece(0, 1)) {
                score += 2; // Bonus points for hard drop
            }
            
            updateDisplay();
        }



        // Game loop
        function gameLoop() {
            if (!gameRunning || gamePaused) return;
            
            if (!movePiece(0, 1)) {
                // Piece can't move down, place it
                placePiece(currentPiece, currentPosition);
                clearLines();
                
                // Spawn new piece
                currentPiece = nextPiece;
                nextPiece = randomPiece();
                currentPosition = { x: 4, y: 0 };

                
                // Check game over
                if (!isValidPosition(currentPiece, currentPosition)) {
                    gameOver();
                    return;
                }
                
                render();
            }
        }

        // Start game
        function startGame() {
            if (gameRunning && !gamePaused) return;
            
            if (!gameRunning) {
                // New game
                board = Array(20).fill().map(() => Array(10).fill(0));
                score = 0;
                lines = 0;
                level = 1;
                currentPiece = randomPiece();
                nextPiece = randomPiece();

                canHold = true;
                currentPosition = { x: 4, y: 0 };
                
                const baseSpeed = difficulty === 'easy' ? 1200 : difficulty === 'medium' ? 1000 : 800;
                fallSpeed = baseSpeed;
                
                gameOverOverlay.style.display = 'none';
                gameRunning = true;
                gamePaused = false;
                
                updateStatus('playing');
                updateDisplay();
                render();
            } else {
                // Resume game
                gamePaused = false;
                updateStatus('playing');
            }
            
            if (gameInterval) clearInterval(gameInterval);
            gameInterval = setInterval(gameLoop, fallSpeed);
        }

        // Pause game
        function pauseGame() {
            if (!gameRunning) return;
            
            gamePaused = !gamePaused;
            
            if (gamePaused) {
                clearInterval(gameInterval);
                updateStatus('paused');
            } else {
                gameInterval = setInterval(gameLoop, fallSpeed);
                updateStatus('playing');
            }
        }

        // Reset game
        function resetGame() {
            gameRunning = false;
            gamePaused = false;
            
            if (gameInterval) {
                clearInterval(gameInterval);
                gameInterval = null;
            }
            
            gameOverOverlay.style.display = 'none';
            updateStatus('ready');
            
            // Reset board
            board = Array(20).fill().map(() => Array(10).fill(0));
            currentPiece = null;
            nextPiece = null;
            
            score = 0;
            lines = 0;
            level = 1;
            
            updateDisplay();
            render();
        }

        // Game over
        function gameOver() {
            gameRunning = false;
            gamePaused = false;
            
            if (gameInterval) {
                clearInterval(gameInterval);
                gameInterval = null;
            }
            
            updateStatus('gameOver');
            finalScore.textContent = score.toLocaleString();
            finalLines.textContent = lines;
            gameOverOverlay.style.display = 'flex';
        }

        // Update status
        function updateStatus(status) {
            const t = translations[currentLanguage];
            statusDisplay.textContent = t.status[status];
        }

        // Language functions
        function setLanguage(lang, event) {
            currentLanguage = lang;
            localStorage.setItem('tetrisLanguage', lang);
            
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            updateLanguage();
        }

        function updateLanguage() {
            const t = translations[currentLanguage];
            
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const keys = element.getAttribute('data-i18n').split('.');
                let value = t;
                keys.forEach(key => {
                    value = value[key];
                });
                element.textContent = value;
            });
            
            // Update theme button
            const theme = document.body.classList.contains('light-theme') ? 'light' : 'dark';
            themeToggle.textContent = t.theme[theme];
        }

        // Difficulty selection
        function setDifficulty(diff, event) {
            difficulty = diff;
            document.querySelectorAll('.diff-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        // Theme functions
        function toggleTheme() {
            if (document.body.classList.contains('light-theme')) {
                setTheme('dark');
            } else {
                setTheme('light');
            }
        }

        function setTheme(theme) {
            const t = translations[currentLanguage];
            if (theme === 'light') {
                document.body.classList.add('light-theme');
                themeToggle.textContent = t.theme.light;
            } else {
                document.body.classList.remove('light-theme');
                themeToggle.textContent = t.theme.dark;
            }
            localStorage.setItem('tetrisTheme', theme);
        }

        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            if (!gameRunning) return;
            
            switch(e.key) {
                case 'ArrowLeft':
                    e.preventDefault();
                    movePiece(-1, 0);
                    break;
                case 'ArrowRight':
                    e.preventDefault();
                    movePiece(1, 0);
                    break;
                case 'ArrowDown':
                    e.preventDefault();
                    if (movePiece(0, 1)) {
                        score += 1; // Bonus for soft drop
                        updateDisplay();
                    }
                    break;
                case 'ArrowUp':
                    e.preventDefault();
                    rotateCurrent();
                    break;
                case ' ':
                    e.preventDefault();
                    hardDrop();
                    break;

                case 'p':
                case 'P':
                    e.preventDefault();
                    pauseGame();
                    break;
            }
        });

        // Create background particles
        function createBackgroundParticles() {
            for (let i = 0; i < 12; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.width = Math.random() * 10 + 5 + 'px';
                particle.style.height = particle.style.width;
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 15 + 's';
                particle.style.animationDuration = (Math.random() * 10 + 15) + 's';
                document.body.appendChild(particle);
            }
        }

        // Load saved data
        function loadSavedData() {
            const savedTheme = localStorage.getItem('tetrisTheme') || 'dark';
            setTheme(savedTheme);

            const savedLanguage = localStorage.getItem('tetrisLanguage') || 'en';
            currentLanguage = savedLanguage;
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if ((savedLanguage === 'en' && btn.textContent.includes('EN')) ||
                    (savedLanguage === 'zh' && btn.textContent.includes('中文'))) {
                    btn.classList.add('active');
                }
            });
            updateLanguage();
        }

        // Initialize game
        function init() {
            initBoard();
            createBackgroundParticles();
            loadSavedData();
            updateDisplay();
            render();
        }

        // Start initialization when page loads
        init();
    </script>
    
    <!-- AI Credit -->
    <div style="position: fixed; bottom: 10px; right: 15px; font-size: 11px; color: rgba(255,255,255,0.4); font-family: 'Segoe UI', sans-serif; z-index: 1000; pointer-events: none;">
        AI-Generated Script by Albix4563
    </div>
</body>
</html>